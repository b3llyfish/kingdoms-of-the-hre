# Calls the kingdom specific diverge culture function
diverge_culture_with_conversion = {
	$CHARACTER$ = {
		if = {
			limit = {
				primary_title = title:k_upper_saxony
			}
			upper_saxony_culture_diverge = {
				CHARACTER = $CHARACTER$
			}
		}
		else_if = {
			limit = {
				primary_title = title:k_switzerland
			}
			switzerland_culture_diverge = {
				CHARACTER = $CHARACTER$
			}
		}
		else_if = {
			limit = {
				primary_title = title:k_austria
			}
			austria_culture_diverge = {
				CHARACTER = $CHARACTER$
			}
		}
		else_if = {
			limit = {
				primary_title = title:k_slavinia
			}
			slavinia_culture_diverge = {
				CHARACTER = $CHARACTER$
			}
		}
		else = {
			generic_culture_diverge = {
				CHARACTER = $CHARACTER$
			}
		}
	}
}

# setup unique culture
# convert south-west upper saxony counties to new culture
# offer convert to family, courtier and vassals
upper_saxony_culture_diverge = {
	$CHARACTER$ = {
		culture = {
			save_scope_as = old_culture
		}
		create_divergent_culture = yes
		scope:new_culture = {
			# respect divergent rules and change culture pillar
			set_culture_pillar = ethos_courtly
			# build a unique set of traditions
			clear_culture_traditions = yes
			add_culture_tradition = tradition_ruling_caste
			add_culture_tradition = tradition_formation_fighting
			add_culture_tradition = tradition_storytellers
		}
		# build list of titles whose counties will be converted
		title:c_magdeburg = {
			add_to_list = title_list
		}
		title:c_dessau = {
			add_to_list = title_list
		}
		title:c_mersenburg = {
			add_to_list = title_list
		}
		title:c_orlamunde = {
			add_to_list = title_list
		}
		title:c_lobdaburg = {
			add_to_list = title_list
		}
		title:c_naumburg = {
			add_to_list = title_list
		}
		title:c_wolkenstein = {
			add_to_list = title_list
		}
		title:c_vogtland = {
			add_to_list = title_list
		}
		title:c_osterland = {
			add_to_list = title_list
		}
		title:c_brene = {
			add_to_list = title_list
		}
		title:c_meissen = {
			add_to_list = title_list
		}
		title:c_dresden = {
			add_to_list = title_list
		}
		title:c_wittenberg = {
			add_to_list = title_list
		}
		every_in_list = {
			list = title_list
			every_in_de_jure_hierarchy = {
				limit = {
					tier = tier_county
				}
				set_county_culture = scope:new_culture
			}
		}
	}
	convert_family_culture_and_notify_vassals_effect = {
		CONVERTER = $CHARACTER$
		OLD_CULTURE = scope:old_culture
		NEW_CULTURE = scope:new_culture
	}
}

# setup unique culture
# convert d_transjurania and d_currezia to swiss
# offer convert to family, courtier and vassals
switzerland_culture_diverge = {
	$CHARACTER$ = {
		culture = {
			save_scope_as = old_culture
		}
		create_divergent_culture = yes
		# setup culture with city holding and development theme
		scope:new_culture = {
			set_culture_pillar = ethos_bureaucratic
			clear_culture_traditions = yes
			add_culture_tradition = tradition_city_keepers
			add_culture_tradition = tradition_mountain_homes
			add_culture_tradition = tradition_parochialism
		}
		# build list of titles whose counties will be converted
		title:d_transjurania = {
			add_to_list = title_list
		}
		title:d_currezia = {
			add_to_list = title_list
		}
		every_in_list = {
			list = title_list
			every_in_de_jure_hierarchy = {
				limit = {
					tier = tier_county
				}
				set_county_culture = scope:new_culture
			}
		}
	}
	convert_family_culture_and_notify_vassals_effect = {
		CONVERTER = $CHARACTER$
		OLD_CULTURE = scope:old_culture
		NEW_CULTURE = scope:new_culture
	}
}

# setup unique culture
# convert d_transjurania and d_currezia to swiss
# offer convert to family, courtier and vassals
austria_culture_diverge = {
	$CHARACTER$ = {
		culture = {
			save_scope_as = old_culture
		}
		create_divergent_culture = yes
		# setup culture with diplomacy and feasting theme
		scope:new_culture = {
			set_culture_pillar = ethos_communal
			clear_culture_traditions = yes
			add_culture_tradition = tradition_music_theory
			add_culture_tradition = tradition_festivities
			add_culture_tradition = tradition_welcoming
		}
		# build list of titles whose counties will be converted
		title:d_osterreich = {
			add_to_list = title_list
		}
		title:c_graz = {
			add_to_list = title_list
		}
		title:c_murzzuschlag = {
			add_to_list = title_list
		}
		title:c_pitten = {
			add_to_list = title_list
		}
		every_in_list = {
			list = title_list
			every_in_de_jure_hierarchy = {
				limit = {
					tier = tier_county
				}
				set_county_culture = scope:new_culture
			}
		}
	}
	convert_family_culture_and_notify_vassals_effect = {
		CONVERTER = $CHARACTER$
		OLD_CULTURE = scope:old_culture
		NEW_CULTURE = scope:new_culture
	}
}

slavinia_culture_diverge = {
	$CHARACTER$ = {
		culture = {
			save_scope_as = old_culture
		}
		create_divergent_culture = yes
		scope:new_culture = {
			set_culture_pillar = ethos_spiritual
			clear_culture_traditions = yes
			add_culture_tradition = tradition_ruling_caste
			add_culture_tradition = tradition_monastic_communities
			add_culture_tradition = tradition_adaptive_skirmishing
		}
		# build list of titles whose counties will be converted
		title:c_brandenburg = {
			add_to_list = title_list
		}
		title:c_ruppin = {
			add_to_list = title_list
		}
		title:c_havelberg = {
			add_to_list = title_list
		}
		title:c_stendal = {
			if = {
				limit = {
					culture = culture:polabian
				}
				add_to_list = title_list
			}
		}
		title:c_dannenberg = {
			if = {
				limit = {
					culture = culture:polabian
				}
				add_to_list = title_list
			}
		}
		every_in_list = {
			list = title_list
			every_in_de_jure_hierarchy = {
				limit = {
					tier = tier_county
				}
				set_county_culture = scope:new_culture
			}
		}
	}
	convert_family_culture_and_notify_vassals_effect = {
		CONVERTER = $CHARACTER$
		OLD_CULTURE = scope:old_culture
		NEW_CULTURE = scope:new_culture
	}
}

# diverge culture like the AI would
# convert capital duchy
# offer convert to family, courtier and vassals
generic_culture_diverge = {
	$CHARACTER$ = {
		culture = {
			save_scope_as = old_culture
		}
		create_divergent_culture_with_side_effects_excluding_cost = yes
		culture = {
			save_scope_as = new_culture
		}
		capital_county.duchy = {
			every_in_de_jure_hierarchy = {
				limit = {
					tier = tier_county
				}
				set_county_culture = scope:new_culture
			}
		}
	}
	convert_family_culture_and_notify_vassals_effect = {
		CONVERTER = $CHARACTER$
		OLD_CULTURE = scope:old_culture
		NEW_CULTURE = scope:new_culture
	}
}

convert_to_local_culture = {
	convert_family_culture_and_notify_vassals_effect = {
		CONVERTER = $CHARACTER$
		OLD_CULTURE = $CHARACTER$.culture
		NEW_CULTURE = $CHARACTER$.capital_province.culture
	}
}