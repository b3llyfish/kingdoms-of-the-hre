# Calls the kingdom specific diverge culture function
diverge_culture_with_conversion = {
	$CHARACTER$ = {
		if = {
			limit = {
				primary_title = title:k_upper_saxony
			}
			upper_saxony_culture_diverge = {
				CHARACTER = $CHARACTER$
			}
		}
		else_if = {
			limit = {
				primary_title = title:k_switzerland
			}
			switzerland_culture_diverge = {
				CHARACTER = $CHARACTER$
			}
		}
		else = {
			generic_culture_diverge = {
				CHARACTER = $CHARACTER$
			}
		}
	}
}

# setup unique culture
# convert a bunch of polabian counties to upper saxony
# offer convert to family, courtier and vassals
upper_saxony_culture_diverge = {
	$CHARACTER$ = {
		culture = {
			save_scope_as = old_culture
		}
		create_divergent_culture = yes
		scope:new_culture = {
			# respect divergent rules and change culture pillar
			set_culture_pillar = ethos_courtly
			# build a unique set of traditions
			clear_culture_traditions = yes
			add_culture_tradition = tradition_hereditary_hierarchy
			add_culture_tradition = tradition_formation_fighting
			add_culture_tradition = tradition_storytellers
		}
		# build list of titles whose counties will be converted
		title:d_anhalt = {
			add_to_list = title_list
		}
		title:d_thuringia = {
			add_to_list = title_list
		}
		title:c_naumburg = {
			add_to_list = title_list
		}
		title:c_wolkenstein = {
			add_to_list = title_list
		}
		title:c_vogtland = {
			add_to_list = title_list
		}
		title:c_osterland = {
			add_to_list = title_list
		}
		every_in_list = {
			list = title_list
			every_in_de_jure_hierarchy = {
				limit = {
					tier = tier_county
					culture = culture:polabian
				}
				set_county_culture = scope:new_culture
			}
		}
	}
	convert_family_culture_and_notify_vassals_effect = {
		CONVERTER = $CHARACTER$
		OLD_CULTURE = scope:old_culture
		NEW_CULTURE = scope:new_culture
	}
}

# setup unique culture
# convert d_transjurania and d_currezia to swiss
# offer convert to family, courtier and vassals
switzerland_culture_diverge = {
	$CHARACTER$ = {
		culture = {
			save_scope_as = old_culture
		}
		create_divergent_culture = yes
		# setup culture with city holding and development theme
		scope:new_culture = {
			set_culture_pillar = ethos_bureaucratic
			clear_culture_traditions = yes
			add_culture_tradition = tradition_city_keepers
			add_culture_tradition = tradition_mountain_homes
			add_culture_tradition = tradition_parochialism
			add_culture_tradition = tradition_pacifism
		}
		# build list of titles whose counties will be converted
		title:d_transjurania = {
			add_to_list = title_list
		}
		title:d_currezia = {
			add_to_list = title_list
		}
		every_in_list = {
			list = title_list
			every_in_de_jure_hierarchy = {
				limit = {
					tier = tier_county
					culture = scope:old_culture
				}
				set_county_culture = scope:new_culture
			}
		}
	}
	convert_family_culture_and_notify_vassals_effect = {
		CONVERTER = $CHARACTER$
		OLD_CULTURE = scope:old_culture
		NEW_CULTURE = scope:new_culture
	}
}

# diverge culture like the AI would
# convert capital duchy
# offer convert to family, courtier and vassals
generic_culture_diverge = {
	$CHARACTER$ = {
		culture = {
			save_scope_as = old_culture
		}
		create_divergent_culture_with_side_effects_excluding_cost = yes
		culture = {
			save_scope_as = new_culture
		}
		capital_county.duchy = {
			every_in_de_jure_hierarchy = {
				limit = {
					tier = tier_county
					culture = scope:old_culture
				}
				set_county_culture = scope:new_culture
			}
		}
	}
	convert_family_culture_and_notify_vassals_effect = {
		CONVERTER = $CHARACTER$
		OLD_CULTURE = scope:old_culture
		NEW_CULTURE = scope:new_culture
	}
}